syntax = "proto3";

package api.order.v1;

option go_package = "github.com/wyfcoding/financialTrading/goapi/order/v1;orderv1";

// 订单全生命周期交易服务。
service OrderService {
  // 新建委托单。
  rpc CreateOrder(CreateOrderRequest) returns (CreateOrderResponse);
  // 撤销未成委托。
  rpc CancelOrder(CancelOrderRequest) returns (CancelOrderResponse);
  // 修改委托属性。
  rpc ModifyOrder(ModifyOrderRequest) returns (ModifyOrderResponse);
  // 单笔详情查询。
  rpc GetOrder(GetOrderRequest) returns (GetOrderResponse);
  // 列表历史检索。
  rpc ListOrders(ListOrdersRequest) returns (ListOrdersResponse);
  // 实时更新订阅流。
  rpc SubscribeOrders(SubscribeOrdersRequest) returns (stream SubscribeOrdersResponse);
}

// 委托单档案实体。
message Order {
  // 订单唯一 ID。
  string order_id = 1;
  // 用户 ID。
  string user_id = 2;
  // 品种代码。
  string symbol = 3;
  // 交易方向。
  string side = 4;
  // 委托类别标识。
  string order_type = 5;
  // 价格。
  string price = 6;
  // 数量总量。
  string quantity = 7;
  // 累计成交量。
  string filled_quantity = 8;
  // 订单状态枚举值。
  string status = 9;
  // 有效约束策略。
  string time_in_force = 10;
  // 建立时刻。
  int64 created_at = 11;
  // 更新时刻。
  int64 updated_at = 12;
  // 驳回错误描述。
  string error_message = 13;
}

// 建立请求详情。
message CreateOrderRequest {
  // 所有人。
  string user_id = 1;
  // 代码。
  string symbol = 2;
  // 方向。
  string side = 3;
  // 类型。
  string order_type = 4;
  // 价点。
  string price = 5;
  // 拟成规模。
  string quantity = 6;
  // 成交约定。
  string time_in_force = 7;
  // 客户自定义 ID。
  string client_order_id = 8;
}

// 委托回执详情。
message CreateOrderResponse {
  // 档案档案详情。
  Order order = 1;
}

// 撤单请求条件。
message CancelOrderRequest {
  // 订单 ID。
  string order_id = 1;
  // 鉴权人 ID。
  string user_id = 2;
}

// 撤单确认响应。
message CancelOrderResponse {
  // 修改后的档案快照。
  Order order = 1;
}

// 变更请求载荷。
message ModifyOrderRequest {
  // 系统单号。
  string order_id = 1;
  // 所有人。
  string user_id = 2;
  // 覆盖价点。
  string price = 3;
  // 覆盖数量。
  string quantity = 4;
}

// 变更回执详情。
message ModifyOrderResponse {
  // 修改后的档案快照。
  Order order = 1;
}

// 详情请求载荷。
message GetOrderRequest {
  // 单号标识。
  string order_id = 1;
  // 归属人 ID。
  string user_id = 2;
}

// 详情回执响应。
message GetOrderResponse {
  // 档案全量快照。
  Order order = 1;
}

// 列表查询条件。
message ListOrdersRequest {
  // 用户过滤。
  string user_id = 1;
  // 代码筛选。
  string symbol = 2;
  // 状态筛选。
  string status = 3;
  // 页码。
  int32 page = 4;
  // 规模。
  int32 page_size = 5;
}

// 检索结果序列。
message ListOrdersResponse {
  // 记录序列。
  repeated Order orders = 1;
  // 命中总笔数。
  int64 total = 2;
  // 所在页码。
  int32 page = 3;
  // 单页规模限制。
  int32 page_size = 4;
}

// 订阅订阅载荷。
message SubscribeOrdersRequest {
  // 所有人。
  string user_id = 1;
  // 标的范围。
  repeated string symbols = 2;
}

// 状态推送详情。
message SubscribeOrdersResponse {
  // 系统单号。
  string order_id = 1;
  // 用户。
  string user_id = 2;
  // 代码。
  string symbol = 3;
  // 更新状态值。
  string status = 4;
  // 当前累计。
  string filled_quantity = 5;
  // 时间。
  int64 timestamp = 6;
}
