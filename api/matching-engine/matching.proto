syntax = "proto3";

package matching_engine;

option go_package = "github.com/fynnwu/FinancialTrading/go-api/matching-engine;matching_engine";

// 撮合引擎服务
service MatchingEngineService {
  // 提交订单进行撮合
  rpc SubmitOrder(SubmitOrderRequest) returns (MatchResult);
  // 获取订单簿
  rpc GetOrderBook(GetOrderBookRequest) returns (OrderBookSnapshot);
  // 获取成交记录
  rpc GetTrades(GetTradesRequest) returns (TradesResponse);
  // 订阅成交更新（流式）
  rpc SubscribeTrades(SubscribeTradesRequest) returns (stream TradeUpdate);
}

message SubmitOrderRequest {
  string order_id = 1;
  string symbol = 2;
  string side = 3;
  string price = 4;
  string quantity = 5;
}

message MatchResult {
  string order_id = 1;
  repeated Trade matched_trades = 2;
  string remaining_quantity = 3;
  string status = 4;
}

message Trade {
  string trade_id = 1;
  string buy_order_id = 2;
  string sell_order_id = 3;
  string price = 4;
  string quantity = 5;
  int64 timestamp = 6;
}

message GetOrderBookRequest {
  string symbol = 1;
  int32 depth = 2;
}

message OrderBookLevel {
  string price = 1;
  string quantity = 2;
}

message OrderBookSnapshot {
  string symbol = 1;
  repeated OrderBookLevel bids = 2;
  repeated OrderBookLevel asks = 3;
  int64 timestamp = 4;
}

message GetTradesRequest {
  string symbol = 1;
  int32 limit = 2;
}

message TradesResponse {
  string symbol = 1;
  repeated Trade trades = 2;
}

message SubscribeTradesRequest {
  repeated string symbols = 1;
}

message TradeUpdate {
  string trade_id = 1;
  string symbol = 2;
  string price = 3;
  string quantity = 4;
  int64 timestamp = 5;
}
