syntax = "proto3";

package quant;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/fynnwu/FinancialTrading/go-api/quant;quant";

// 量化研发服务。
service QuantService {
  // 定义新策略。
  rpc CreateStrategy(CreateStrategyRequest) returns (CreateStrategyResponse);

  // 检索策略详情。
  rpc GetStrategy(GetStrategyRequest) returns (GetStrategyResponse);

  // 提交回测任务。
  rpc RunBacktest(RunBacktestRequest) returns (RunBacktestResponse);

  // 查询回测结果报告。
  rpc GetBacktestResult(GetBacktestResultRequest) returns (GetBacktestResultResponse);
}

// 策略档案。
message Strategy {
  // 唯一 ID。
  string id = 1;
  // 名称。
  string name = 2;
  // 简介。
  string description = 3;
  // 脚本或配置串。
  string script = 4;
  // 状态。
  string status = 5;
  // 录入日期。
  google.protobuf.Timestamp created_at = 6;
  // 修改日期。
  google.protobuf.Timestamp updated_at = 7;
}

// 回测报告。
message BacktestResult {
  // 结果 ID。
  string id = 1;
  // 关联策略 ID。
  string strategy_id = 2;
  // 目标品种。
  string symbol = 3;
  // 起始日期。
  google.protobuf.Timestamp start_time = 4;
  // 结束日期。
  google.protobuf.Timestamp end_time = 5;
  // 收益率。
  double total_return = 6;
  // 峰值回撤。
  double max_drawdown = 7;
  // 风险调整收益。
  double sharpe_ratio = 8;
  // 累计笔数。
  int32 total_trades = 9;
  // 任务状态。
  string status = 10;
  // 运行时间。
  google.protobuf.Timestamp created_at = 11;
}

// 录入请求。
message CreateStrategyRequest {
  // 名称。
  string name = 1;
  // 介绍。
  string description = 2;
  // 脚本内容。
  string script = 3;
}

// 录入响应。
message CreateStrategyResponse {
  // 策略 ID。
  string strategy_id = 1;
}

// 查询请求。
message GetStrategyRequest {
  // 记录 ID。
  string id = 1;
}

// 查询响应。
message GetStrategyResponse {
  // 策略实体。
  Strategy strategy = 1;
}

// 回测请求。
message RunBacktestRequest {
  // 策略 ID。
  string strategy_id = 1;
  // 交易对。
  string symbol = 2;
  // 开始。
  google.protobuf.Timestamp start_time = 3;
  // 结束。
  google.protobuf.Timestamp end_time = 4;
  // 模拟资金。
  double initial_capital = 5;
}

// 回测响应。
message RunBacktestResponse {
  // 任务 ID。
  string backtest_id = 1;
}

// 报告查询。
message GetBacktestResultRequest {
  // 任务 ID。
  string id = 1;
}

// 报告详情。
message GetBacktestResultResponse {
  // 报告实体。
  BacktestResult result = 1;
}
