syntax = "proto3";

package risk.v1;

import "risk/v1/error_reason.proto";

option go_package = "github.com/wyfcoding/financialtrading/go-api/risk/v1;v1";

service RiskService {
  rpc CheckRisk(CheckRiskRequest) returns (CheckRiskResponse) {};
  rpc SetRiskLimit(SetRiskLimitRequest) returns (SetRiskLimitResponse) {};
  
  // Enhanced Risk Assessment
  rpc AssessRisk(AssessRiskRequest) returns (AssessRiskResponse) {};
  rpc GetRiskMetrics(GetRiskMetricsRequest) returns (GetRiskMetricsResponse) {};
  rpc CheckRiskLimit(CheckRiskLimitRequest) returns (CheckRiskLimitResponse) {};
  rpc GetRiskAlerts(GetRiskAlertsRequest) returns (GetRiskAlertsResponse) {};
}

message CheckRiskRequest {
  string user_id = 1;
  string symbol = 2;
  string side = 3; // "buy" or "sell"
  double price = 4;
  double quantity = 5;
}

message CheckRiskResponse {
  bool passed = 1;
  string reason = 2; // If not passed
}

message SetRiskLimitRequest {
  string user_id = 1;
  double max_order_size = 2;
  double max_daily_loss = 3;
}

message SetRiskLimitResponse {
  bool success = 1;
}

message AssessRiskRequest {
  string user_id = 1;
  string symbol = 2;
  string side = 3;
  string quantity = 4; // Decimal string
  string price = 5; // Decimal string
}

message AssessRiskResponse {
  bool is_allowed = 1;
  string reason = 2;
  string risk_level = 3;
  string margin_requirement = 4;
  string risk_score = 5;
}

message GetRiskMetricsRequest {
  string user_id = 1;
}

message RiskMetrics {
  string var_95 = 1;
  string var_99 = 2;
  string max_drawdown = 3;
  string sharpe_ratio = 4;
  string correlation = 5;
}

message GetRiskMetricsResponse {
  RiskMetrics metrics = 1;
}

message CheckRiskLimitRequest {
  string user_id = 1;
  string limit_type = 2;
}

message CheckRiskLimitResponse {
  string limit_type = 1;
  string limit_value = 2;
  string current_value = 3;
  string remaining = 4;
  bool is_exceeded = 5;
}

message GetRiskAlertsRequest {
  string user_id = 1;
  int32 limit = 2;
}

message RiskAlert {
  string alert_id = 1;
  string alert_type = 2;
  string severity = 3;
  string message = 4;
  int64 timestamp = 5;
}

message GetRiskAlertsResponse {
  repeated RiskAlert alerts = 1;
}
