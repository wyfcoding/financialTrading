syntax = "proto3";

package market_making;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/fynnwu/FinancialTrading/go-api/market-making;market_making";

// 做市服务，负责自动化策略管理、报价参数控制及绩效跟踪。
service MarketMakingService {
  // 录入或覆盖特定交易对的自动化报价规则。
  rpc SetStrategy(SetStrategyRequest) returns (SetStrategyResponse);

  // 查询当前正在运作的报价策略详情。
  rpc GetStrategy(GetStrategyRequest) returns (GetStrategyResponse);

  // 统计并获取做市期间的 PnL 及各类交易指标。
  rpc GetPerformance(GetPerformanceRequest) returns (GetPerformanceResponse);
}

// 报价策略档案。
message QuoteStrategy {
  // 策略 ID。
  string id = 1;
  // 目标代码。
  string symbol = 2;
  // 目标挂单价差。
  double spread = 3;
  // 最小报单量。
  double min_order_size = 4;
  // 最大报单量。
  double max_order_size = 5;
  // 允许的最大持仓规模。
  double max_position = 6;
  // 状态。
  string status = 7;
  // 创建日期。
  google.protobuf.Timestamp created_at = 8;
  // 修改日期。
  google.protobuf.Timestamp updated_at = 9;
}

// 绩效快照。
message MarketMakingPerformance {
  // 交易对。
  string symbol = 1;
  // 累计盈亏。
  double total_pnl = 2;
  // 累计成交规模。
  double total_volume = 3;
  // 累计笔数。
  int32 total_trades = 4;
  // 策略稳定性评分。
  double sharpe_ratio = 5;
  // 统计起始。
  google.protobuf.Timestamp start_time = 6;
  // 统计截止。
  google.protobuf.Timestamp end_time = 7;
}

// 规则设置请求。
message SetStrategyRequest {
  // 交易对。
  string symbol = 1;
  // 点差。
  double spread = 2;
  // 最小量。
  double min_order_size = 3;
  // 最大量。
  double max_order_size = 4;
  // 仓位上限。
  double max_position = 5;
  // 初始状态。
  string status = 6;
}

// 设置响应。
message SetStrategyResponse {
  // 任务/策略 ID。
  string strategy_id = 1;
}

// 规则查询。
message GetStrategyRequest {
  // 交易对。
  string symbol = 1;
}

// 规则响应。
message GetStrategyResponse {
  // 策略详情。
  QuoteStrategy strategy = 1;
}

// 绩效查询。
message GetPerformanceRequest {
  // 交易对。
  string symbol = 1;
  // 开始。
  google.protobuf.Timestamp start_time = 2;
  // 结束。
  google.protobuf.Timestamp end_time = 3;
}

// 绩效响应。
message GetPerformanceResponse {
  // 绩效档案。
  MarketMakingPerformance performance = 1;
}
