syntax = "proto3";

package market_data;

option go_package = "github.com/fynnwu/FinancialTrading/go-api/market-data;market_data";

// 市场数据服务
service MarketDataService {
  // 获取最新行情
  rpc GetLatestQuote(GetLatestQuoteRequest) returns (QuoteResponse);
  // 获取 K 线数据
  rpc GetKlines(GetKlinesRequest) returns (KlinesResponse);
  // 获取订单簿快照
  rpc GetOrderBook(GetOrderBookRequest) returns (OrderBookResponse);
  // 订阅行情更新（流式）
  rpc SubscribeQuotes(SubscribeQuotesRequest) returns (stream QuoteUpdate);
  // 获取交易历史
  rpc GetTrades(GetTradesRequest) returns (TradesResponse);
}

// 获取最新行情请求
message GetLatestQuoteRequest {
  string symbol = 1;
}

// 行情响应
message QuoteResponse {
  string symbol = 1;
  double bid_price = 2;
  double ask_price = 3;
  double bid_size = 4;
  double ask_size = 5;
  double last_price = 6;
  double last_size = 7;
  int64 timestamp = 8;
}

// 获取 K 线请求
message GetKlinesRequest {
  string symbol = 1;
  string interval = 2; // 1m, 5m, 15m, 1h, 4h, 1d
  int32 limit = 3;
}

// K 线数据
message Kline {
  int64 open_time = 1;
  double open = 2;
  double high = 3;
  double low = 4;
  double close = 5;
  double volume = 6;
  int64 close_time = 7;
}

// K 线响应
message KlinesResponse {
  string symbol = 1;
  string interval = 2;
  repeated Kline klines = 3;
}

// 获取订单簿请求
message GetOrderBookRequest {
  string symbol = 1;
  int32 depth = 2; // 默认 20
}

// 订单簿层级
message OrderBookLevel {
  double price = 1;
  double quantity = 2;
}

// 订单簿响应
message OrderBookResponse {
  string symbol = 1;
  repeated OrderBookLevel bids = 2;
  repeated OrderBookLevel asks = 3;
  int64 timestamp = 4;
}

// 订阅行情请求
message SubscribeQuotesRequest {
  repeated string symbols = 1;
}

// 行情更新
message QuoteUpdate {
  string symbol = 1;
  double bid_price = 2;
  double ask_price = 3;
  double bid_size = 4;
  double ask_size = 5;
  double last_price = 6;
  double last_size = 7;
  int64 timestamp = 8;
}

// 获取交易历史请求
message GetTradesRequest {
  string symbol = 1;
  int32 limit = 2;
}

// 交易记录
message TradeRecord {
  string trade_id = 1;
  string symbol = 2;
  double price = 3;
  double quantity = 4;
  string side = 5; // BUY or SELL
  int64 timestamp = 6;
}

// 交易历史响应
message TradesResponse {
  string symbol = 1;
  repeated TradeRecord trades = 2;
}
