syntax = "proto3";

package market_data;

option go_package = "github.com/fynnwu/FinancialTrading/go-api/market-data;market_data";

// 市场数据服务
service MarketDataService {
  // 获取最新行情
  rpc GetLatestQuote(GetLatestQuoteRequest) returns (QuoteResponse);
  // 获取 K 线数据
  rpc GetKlines(GetKlinesRequest) returns (KlinesResponse);
  // 获取订单簿快照
  rpc GetOrderBook(GetOrderBookRequest) returns (OrderBookResponse);
  // 订阅行情更新（流式）
  rpc SubscribeQuotes(SubscribeQuotesRequest) returns (stream QuoteUpdate);
  // 获取交易历史
  rpc GetTrades(GetTradesRequest) returns (TradesResponse);
}

// 获取最新行情请求
message GetLatestQuoteRequest {
  string symbol = 1; // 交易对符号
}

// 行情响应
message QuoteResponse {
  string symbol = 1; // 交易对符号
  double bid_price = 2; // bid价格
  double ask_price = 3; // ask价格
  double bid_size = 4; // bid大小
  double ask_size = 5; // ask大小
  double last_price = 6; // last价格
  double last_size = 7; // last大小
  int64 timestamp = 8; // 时间戳
}

// 获取 K 线请求
message GetKlinesRequest {
  string symbol = 1; // 交易对符号
  string interval = 2; // 间隔
  int32 limit = 3; // 限制
}

// K 线数据
message Kline {
  int64 open_time = 1; // open时间
  double open = 2; // 打开
  double high = 3; // 最高
  double low = 4; // 最低
  double close = 5; // 关闭
  double volume = 6; // 成交量
  int64 close_time = 7; // close时间
}

// K 线响应
message KlinesResponse {
  string symbol = 1; // 交易对符号
  string interval = 2; // 间隔
  repeated Kline klines = 3; // K线
}

// 获取订单簿请求
message GetOrderBookRequest {
  string symbol = 1; // 交易对符号
  int32 depth = 2; // 默认 20
}

// 订单簿层级
message OrderBookLevel {
  double price = 1; // 价格
  double quantity = 2; // 数量
}

// 订单簿响应
message OrderBookResponse {
  string symbol = 1; // 交易对符号
  repeated OrderBookLevel bids = 2; // 买入
  repeated OrderBookLevel asks = 3; // 卖出
  int64 timestamp = 4; // 时间戳
}

// 订阅行情请求
message SubscribeQuotesRequest {
  repeated string symbols = 1; // 交易对符号
}

// 行情更新
message QuoteUpdate {
  string symbol = 1; // 交易对符号
  double bid_price = 2; // bid价格
  double ask_price = 3; // ask价格
  double bid_size = 4; // bid大小
  double ask_size = 5; // ask大小
  double last_price = 6; // last价格
  double last_size = 7; // last大小
  int64 timestamp = 8; // 时间戳
}

// 获取交易历史请求
message GetTradesRequest {
  string symbol = 1; // 交易对符号
  int32 limit = 2; // 限制
}

// 交易记录
message TradeRecord {
  string trade_id = 1; // 成交id
  string symbol = 2; // 交易对符号
  double price = 3; // 价格
  double quantity = 4; // 数量
  string side = 5; // 买入或卖出
  int64 timestamp = 6; // 时间戳
}

// 交易历史响应
message TradesResponse {
  string symbol = 1; // 交易对符号
  repeated TradeRecord trades = 2; // 交易列表
}
