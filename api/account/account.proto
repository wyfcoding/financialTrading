syntax = "proto3";

package account;

option go_package = "github.com/fynnwu/FinancialTrading/go-api/account;account";

// 账户服务，负责多资产余额体系、资金存取流水及账户基本信息维护。
service AccountService {
  // 初始化用户特定资产类别的子账户。
  rpc CreateAccount(CreateAccountRequest) returns (AccountResponse);

  // 获取账户层面的静态配置及状态详情。
  rpc GetAccount(GetAccountRequest) returns (AccountResponse);

  // 更新子账户的属性或权限开关。
  rpc UpdateAccount(UpdateAccountRequest) returns (AccountResponse);

  // 实时查询账户的可用、冻结及总余额。
  rpc GetBalance(GetBalanceRequest) returns (BalanceResponse);

  // 执行外部入账操作（充值）。
  rpc Deposit(DepositRequest) returns (TransactionResponse);

  // 发起外部出账操作（提现）。
  rpc Withdraw(WithdrawRequest) returns (TransactionResponse);

  // 检索账户下所有资金变动明细历史。
  rpc GetTransactionHistory(GetTransactionHistoryRequest) returns (TransactionHistoryResponse);
}

// 账户开设请求。
message CreateAccountRequest {
  // 用户 ID。
  string user_id = 1;
  // 类型 (SPOT, MARGIN)。
  string account_type = 2;
  // 结算本币。
  string currency = 3;
}

// 账户详细档案。
message AccountResponse {
  // 账户唯一 ID。
  string account_id = 1;
  // 归属人。
  string user_id = 2;
  // 账户类型名。
  string account_type = 3;
  // 货币代码。
  string currency = 4;
  // 实时总额。
  string balance = 5;
  // 可用总额。
  string available_balance = 6;
  // 建立日期戳。
  int64 created_at = 7;
  // 修改日期戳。
  int64 updated_at = 8;
}

// 账户查询条件。
message GetAccountRequest {
  // 子账户 ID。
  string account_id = 1;
  // 所有人 ID。
  string user_id = 2;
}

// 属性更新请求。
message UpdateAccountRequest {
  // 目标 ID。
  string account_id = 1;
  // 行为人 ID。
  string user_id = 2;
  // 变更字段集。
  map<string, string> updates = 3;
}

// 余额查询请求。
message GetBalanceRequest {
  // 账户 ID。
  string account_id = 1;
  // 所有人 ID。
  string user_id = 2;
}

// 余额实时快照。
message BalanceResponse {
  // 账户 ID。
  string account_id = 1;
  // 系统总额。
  string balance = 2;
  // 自由额度。
  string available_balance = 3;
  // 挂单冻结。
  string frozen_balance = 4;
  // 快照生成日期。
  int64 timestamp = 5;
}

// 充值请求。
message DepositRequest {
  // 目标账户。
  string account_id = 1;
  // 用户 ID。
  string user_id = 2;
  // 金额数值。
  string amount = 3;
  // 币种。
  string currency = 4;
}

// 提现请求。
message WithdrawRequest {
  // 来源账户。
  string account_id = 1;
  // 发起人。
  string user_id = 2;
  // 金额数值。
  string amount = 3;
  // 币种。
  string currency = 4;
  // 链上/外部目标地。
  string address = 5;
}

// 资金事务回执。
message TransactionResponse {
  // 业务流水号。
  string transaction_id = 1;
  // 关联子账户。
  string account_id = 2;
  // 操作动作 (DEPOSIT, WITHDRAW)。
  string type = 3;
  // 变动数额。
  string amount = 4;
  // 流程状态。
  string status = 5;
  // 确认日期。
  int64 timestamp = 6;
}

// 流水查询。
message GetTransactionHistoryRequest {
  // 目标账户。
  string account_id = 1;
  // 所有人。
  string user_id = 2;
  // 数量限制。
  int32 limit = 3;
}

// 单条流水明细。
message Transaction {
  // 事务 ID。
  string transaction_id = 1;
  // 类别标识。
  string type = 2;
  // 变更数值。
  string amount = 3;
  // 当前进度。
  string status = 4;
  // 发生时间。
  int64 timestamp = 5;
}

// 流水列表响应。
message TransactionHistoryResponse {
  // 事务序列。
  repeated Transaction transactions = 1;
}
