version = "1.0.0"

[server]
name = "order"
environment = "dev"

[server.http]
addr = "0.0.0.0"
port = 18002
timeout = "3s"
read_timeout = "3s"
write_timeout = "3s"
idle_timeout = "60s"

[server.grpc]
addr = "0.0.0.0"
port = 19002
timeout = "3s"
max_recv_msg_size = 10485760
max_send_msg_size = 10485760
max_concurrent_streams = 100

[log]
level = "info"
format = "json"
output = "stdout"
file = "logs/order.log"
max_size = 100
max_backups = 3
max_age = 28
compress = true

[tracing]
enabled = true
service_name = "order"
otlp_endpoint = "localhost:4317"

[metrics]
enabled = true
port = "28002"
path = "/metrics"

[jwt]
secret = "financial-secret-key"
issuer = "financialtrading"
expire_duration = "24h"

[snowflake]
type = "snowflake"
start_time = "2024-01-01"
machine_id = 101

[ratelimit]
enabled = true
rate = 500
burst = 100

[circuitbreaker]
enabled = true
timeout = "1s"
max_requests = 1
interval = "5s"

[cache]
prefix = "order:"
default_expiration = "1h"
cleanup_interval = "10m"

[lock]
prefix = "order:lock:"
default_expiration = "10s"
max_retries = 3
retry_delay = "100ms"

[data.database]
driver = "mysql"
dsn = "root:root@tcp(127.0.0.1:3306)/financial_order?charset=utf8mb4&parseTime=True&loc=Local"
max_idle_conns = 20
max_open_conns = 200
conn_max_lifetime = "1h"
slow_threshold = "200ms"
log_level = 4

[data.redis]
addr = "127.0.0.1:6379"
password = "redis_password"
db = 1
pool_size = 50
min_idle_conns = 10
read_timeout = "0.1s"
write_timeout = "0.1s"

[messagequeue.kafka]
brokers = ["localhost:9092"]
topic = "order-events"
group_id = "order-group"
dial_timeout = "10s"
read_timeout = "10s"
write_timeout = "10s"
min_bytes = 1024
max_bytes = 10485760
async = true

[minio]
endpoint = "127.0.0.1:9000"
access_key_id = "minioadmin"
secret_access_key = "minioadmin"
use_ssl = false
bucket_name = "financial-assets"

[services]
[services.matchingengine]
grpc_addr = "127.0.0.1:19007"
http_addr = "127.0.0.1:18007"
[services.risk]
grpc_addr = "127.0.0.1:19004"
http_addr = "127.0.0.1:18004"
